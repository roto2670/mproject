(function(e){function t(t){for(var s,n,d=t[0],c=t[1],r=t[2],m=0,l=[];m<d.length;m++)n=d[m],o[n]&&l.push(o[n][0]),o[n]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);h&&h(t);while(l.length)l.shift()();return a.push.apply(a,r||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],s=!0,d=1;d<i.length;d++){var c=i[d];0!==o[c]&&(s=!1)}s&&(a.splice(t--,1),e=n(n.s=i[0]))}return e}var s={},o={app:0},a=[];function n(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=s,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var d=window["webpackJsonp"]=window["webpackJsonp"]||[],c=d.push.bind(d);d.push=t,d=d.slice();for(var r=0;r<d.length;r++)t(d[r]);var h=c;a.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"034f":function(e,t,i){"use strict";var s=i("64a9"),o=i.n(s);o.a},"1aa9":function(e,t){window.CONSTANTS={IS_DEV:!1,IS_MOCK:!1,HUB_VIEW:{NOT_IN_MAP:0,IN_MAP:1},URL:{BASE_IMG:"static/location/imgs/",YOUR_CLOUD:"https://c2.prota.space",CONSOLE:""},HUB_INFO:{0:"Portal",1:"AT1",2:"AT2"},GADGET_INFO:{1:"JUMBO DRILL(2B)",2:"JUMBO DRILL(3B)",3:"CHARGING CAR",4:"WHEEL LOADER",5:"DUMP TRUCK",6:"EXCAVATOR(WHEEL)",7:"EXCAVATOR(CRAWLER)",8:"SHOTCRETE MACHINE",9:"JCB",10:"CORE DRILLING MACHINE",11:"DOZER",12:"GROUTING MACHINE",13:"MAI PUMP",14:"MOBILE PRODUCTION UNIT",15:"CHARGING PUMP UNIT",16:"BUS",17:"WCBH DRILLING MACHINE",18:"Explosive Van",19:"Concrete Mixer Truck"},MINIMUM_NUMBER:{HUB:1,FILTERED_BEACONS:16},CONTEXT_TYPE:{SCANNER:0,IPCAM:1},USER_STAGE:{SK_ADMIN:0,SK_NORMAL:1,SK_HQ:3,ADNOC_SITE:4,ADNOC_HQ:5,MOI:6},REQUEST_TYPE:{SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",GET_INFO:"get_info",GET_MAP_FILE:"get_map_file",SET_MAP_FILE:"set_map_file",GET_DATA:"get_data",UPDATE_DATA:"update_data",GET_DETECTED_LIST:"get_detected_list",OPEN_STREAM:"open_stream",CLOSE_STREAM:"close_stream"},EVENT_TYPE:{ADDED:"added",UPDATED:"updated",REMOVED:"removed",GET_DETECTED_LIST:"detected",HUB_ONLINE:"on",HUB_OFFLINE:"off",REFRESH:"refresh",REOPEN_STREAM:"reopen_stream"},PRODUCT_KIND:{HUB:"hub",IPCAM:"ipcam",BEACON:"beacon",MIBSSKEC:"mibsskec"},BEACON_DISTANCE_OFFSET:5},window.CONSTANTS.IS_DEV&&(window.CONSTANTS.URL.CONSOLE="http://127.0.0.1:5000")},"1d68":function(e,t,i){},"54d9":function(e,t,i){"use strict";var s=i("b347"),o=i.n(s);o.a},"56d7":function(e,t,i){"use strict";i.r(t);var s={};i.r(s),i.d(s,"websocketConnect",function(){return b}),i.d(s,"websocketDisconnect",function(){return p}),i.d(s,"subscribe",function(){return w}),i.d(s,"unsubscribe",function(){return f}),i.d(s,"updateData",function(){return v}),i.d(s,"getMapFile",function(){return E}),i.d(s,"postMapFile",function(){return I}),i.d(s,"updateGadgetData",function(){return S}),i.d(s,"getInfo",function(){return T}),i.d(s,"getIpcams",function(){return y}),i.d(s,"getHubs",function(){return N}),i.d(s,"getBeacons",function(){return C}),i.d(s,"getDetectBeaconList",function(){return k}),i.d(s,"openIpcamStream",function(){return A}),i.d(s,"closeIpcamStream",function(){return O});var o=i("2b0e"),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"locationTracking"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isLoaded,expression:"isLoaded"}],staticClass:"loading"},[e._m(0)]),e.isWebsocketConnected?i("Top",{attrs:{info:e.info,isConnected:e.isConnected}}):e._e(),e.isWebsocketConnected?i("Map",{attrs:{info:e.info,isConnected:e.isConnected},on:{"map-load":e.handleMapLoad}}):e._e()],1)},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"main-loader"},[i("div"),i("div"),i("div"),i("div")])}],d=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.isEmptyUrl?i("div",{attrs:{id:e.id}}):e._e()},c=[],r=i("ec60"),h=i("bc3a"),m=i.n(h);i("f654"),i("7e3c");class l{constructor(){this._handler={},this._subscribeHandlers=null,this.socket=null,this.clientId=null}connect(e,t,i,s,o){this.socket=new WebSocket(`ws://${e}:${t}/ws`),this.socket.onopen=i,this.socket.onerror=o,this.socket.onclose=s,this.socket.onmessage=e=>{this._onMessage(e)}}disconnect(){this.socket&&this.socket.close()}send(e){this.socket&&this.socket.send(JSON.stringify(e))}call(e,t){const i=this._createRequestId();_.extend(e,{i:i}),this._registerHandler(i,t),this.send(e)}subscribe(e,t){this.call({e:window.CONSTANTS.REQUEST_TYPE.SUBSCRIBE,kwargs:{client_kind:"L"},_t:new Date/1e3},e=>{this.clientId=e,t()}),this._subscribeHandlers=e}unsubscribe(){this.call({e:window.CONSTANTS.REQUEST_TYPE.UNSUBSCRIBE,kwargs:{client_id:this.clientId,client_kind:"L"},_t:new Date/1e3},()=>{}),console.log("unsubscribe is called"),this._subscribeHandlers=null}_createRequestId(){return Math.random().toString(36).substr(2,5)}_registerHandler(e,t){this._handler[e]||(this._handler[e]=t)}_authenticate(){if(this.socket){let e={};e.ident=_createRequestId(),e.value={name:"authenticate",args:"key",namespace:""};const t=JSON.stringify(e);this.send(t)}}_onOpen(e){1===this.readyState&&this._authenticate()}_onClose(e){}_onMessage(e){let t=null;try{t=JSON.parse(e.data)}finally{t&&(_.has(t,"i")?this._handleResponse(t):this._handleEvent(t))}}_handleResponse(e){const t=this._handler[e.i];t&&(t(e.v),delete this._handler[e.i])}_handleEvent(e){if(e)switch(e.e){case window.CONSTANTS.EVENT_TYPE.ADDED:this._subscribeHandlers.added(e);break;case window.CONSTANTS.EVENT_TYPE.UPDATED:this._subscribeHandlers.updated(e);break;case window.CONSTANTS.EVENT_TYPE.REMOVED:this._subscribeHandlers.removed(e);break;case window.CONSTANTS.EVENT_TYPE.GET_DETECTED_LIST:this._subscribeHandlers.getDetectedList(e);break;case window.CONSTANTS.EVENT_TYPE.HUB_ONLINE:this._subscribeHandlers.hub_online(e);break;case window.CONSTANTS.EVENT_TYPE.HUB_OFFLINE:this._subscribeHandlers.hub_offline(e);break;case window.CONSTANTS.EVENT_TYPE.REFRESH:this._subscribeHandlers.refresh(e);break;case window.CONSTANTS.EVENT_TYPE.REOPEN_STREAM:this._subscribeHandlers.reopenStream(e);break}}_onError(e){console.log("Socket is error ",e)}}const u=new l,g=()=>new Date/1e3,b=(e,t,i,s,o)=>{u.connect(e,t,i,s,o)},p=()=>{u.disconnect()},w=(e,t)=>{u.subscribe(e,t)},f=()=>{u.unsubscribe()},v=(e,t,i)=>{u.call({e:window.CONSTANTS.REQUEST_TYPE.UPDATE_DATA,kwargs:{kind:t,data:e},_t:g()},i)},E=e=>{const t=`${window.CONSTANTS.URL.BASE_IMG}map.png`;m()({url:`${window.CONSTANTS.URL.CONSOLE}/dashboard/location/view`,method:"GET",responseType:"text"}).then(i=>{i.data?(console.log("Success to Get map image file",i.data),e(`${window.location.protocol}//${window.location.host}${i.data}`)):(console.warn("Sorry, Img file does not exist"),e(t))}).catch(i=>{console.warn("Failed to get map file ",i),e(t)})},I=(e,t,i)=>{let s=new FormData;e?(s.append("file",e),m.a.post(`${window.CONSTANTS.URL.CONSOLE}/dashboard/location/upload`,s,{headers:{"Content-Type":"multiart/form-data"}}).then(e=>{console.warn("Success to Upload map image file"),t(`http://${window.location.host}${e.data}`)}).catch(e=>{i(e)})):i()},S=(e,t,i)=>{m.a.post(`${window.CONSTANTS.URL.CONSOLE}/dash/beacons/update`,{beacon:e},{headers:{"Content-Type":"application/json"}}).then(e=>{t()}).catch(e=>{i()})},T=e=>{window.CONSTANTS.IS_DEV?e({interval:10,product_id:"mibsskec",stage:0}):m()({url:`${window.CONSTANTS.URL.CONSOLE}/dash/location/info`,method:"GET",responseType:"text"}).then(t=>{t.data?e(t.data):(console.warn("File is not exist"),e())}).catch(t=>{console.warn("Failed to get info ",t),e()})},y=e=>{u.call({e:window.CONSTANTS.REQUEST_TYPE.GET_DATA,kwargs:{kind:window.CONSTANTS.PRODUCT_KIND.IPCAM},_t:g()},e)},N=e=>{u.call({e:window.CONSTANTS.REQUEST_TYPE.GET_DATA,kwargs:{kind:window.CONSTANTS.PRODUCT_KIND.HUB},_t:g()},e)},C=(e,t)=>{u.call({e:window.CONSTANTS.REQUEST_TYPE.GET_DATA,kwargs:{kind:e},_t:g()},t)},k=e=>{u.call({e:window.CONSTANTS.REQUEST_TYPE.GET_DETECTED_LIST,_t:g()},e)},A=(e,t)=>{u.call({e:window.CONSTANTS.REQUEST_TYPE.OPEN_STREAM,kwargs:{ids:e},_t:g()},t)},O=(e,t)=>{u.call({e:window.CONSTANTS.REQUEST_TYPE.CLOSE_STREAM,kwargs:{ids:e},_t:g()},t)};let B=null;class ${constructor(e,t,i,s){if(B)return B;this._timers=[],this._isRunning=!1,this._vm=e,this._detectedCallback=i||function(){},this._failCallback=s||function(){},this.check_threshold=null,this.info=t,B=this}start(){this._isRunning=!0,_.isNumber(this.info.interval)?this.check_threshold=1e3*this.info.interval:this.check_threshold=6e4,this.check_threshold=1e4,this._timers.push(setInterval(()=>{this._refreshBeacons()},this.check_threshold)),console.debug("Beacon detector started")}stop(){this._clearTimer(),this._isRunning=!1,console.debug("Beacon detector stopped")}isRunning(){return this._isRunning}_refreshBeacons(){this._detectedCallback()}_clearTimer(){_.forEach(this._timers,e=>{try{clearInterval(e)}catch(t){console.warn("Failed to clear detector timer.",t)}}),this._timers=[]}}var L={methods:{isNumber:e=>!_.isNaN(e)&&_.isNumber(e),isScanner:e=>{return _.isEqual(e,window.CONSTANTS.PRODUCT_KIND.HUB)},isIpcam:e=>{return _.isEqual(e,window.CONSTANTS.PRODUCT_KIND.IPCAM)}}},D=i("5118"),M=i("ba56"),G=i.n(M),H={name:"Map",props:{info:{type:Object,default:{}},isConnected:{type:Boolean,required:!0}},data(){return{id:"map",map:null,url:"",toast:null,zoomLv:"",hubLayer:"",hubAT1Layer:"",hubAT2Layer:"",camLayer:"",camAT1Layer:"",camAT2Layer:"",workerLayer:[],lostTagWorkerLayer:"",ipcam:"",ipcams:[],contextCoordinate:null,infoWindow:null,hubInfoWindow:null,ipcamFilterOn:0,hubSetIntervalData:{},ipcamSetIntervalData:{},gadgetCount:{},gadgetInfoWindow:null,gadgetInfoNumber:this._.keys(window.CONSTANTS.GADGET_INFO),bcnsData:{},drawnGadgetList:{},isRemoveAll:!1,options:{custom:null,items:[]},markerMap:{hubs:{},cams:{}},tags:{xll:["1","2","8"],xl:["3","14","15","18","19"],l:["4","5","6","7","9","11"]}}},methods:{initloadMap(){this.showLoading(),this.services.getMapFile(e=>{this.map=new r["c"](this.id,{center:[90,50],zoom:5,maxZoom:7,minZoom:4,maxExtent:new r["a"](0,0,180,80),zoomAnimation:!0,zoomInCenter:!1,panAnimation:!1,dragRotate:!1,dragPitch:!1,drgaRotatePitch:!1,touchGesture:!1,touchZoom:!1,touchRotate:!1,touchPitch:!1,touchZoomRotate:!1,doubleClickZoom:!1,baseLayer:new r["b"]("base",[{url:e,extent:[0,0,180,80],opactiy:1}],{opactiy:1})}),this.map.once("baselayerload",()=>{this.hubLayer=new r["e"]("vector21").addTo(this.map),this.hubAT1Layer=new r["e"]("vector22").addTo(this.map),this.hubAT2Layer=new r["e"]("vector23").addTo(this.map),this.camLayer=new r["e"]("vector24").addTo(this.map),this._.forEach(this.gadgetInfoNumber,e=>{this.workerLayer[e]=new r["e"](`vector${e}`).addTo(this.map),this.workerLayer[e].setZIndex(1)}),this.lostTagWorkerLayer=new r["e"]("vector20").addTo(this.map),this.lostTagWorkerLayer.setZIndex(1),this.hubLayer.setZIndex(3),this.hubAT1Layer.setZIndex(3),this.hubAT2Layer.setZIndex(3),this.initContextMenu(),this.map.fitExtent(),this.loadItems(this.info),this.initBeaconLocationHandler(this.info),this.hideLoading()}),this.map.on("zoomend",e=>{this.zoomLv=this.map.getZoom()/11*50;let t=this.zoomLv,i=this.zoomLv;this._.forEach(this.markerMap.hubs,e=>{e.updateSymbol({markerWidth:t,markerHeight:i})}),this._.forEach(this.markerMap.cams,e=>{e.updateSymbol({markerWidth:t,markerHeight:i})})})})},initBeaconLocationHandler(e){this.beaconDetector=new $(this,e,()=>{},e=>{console.warn("There's no data to update")}),this.startDetector()},initContextMenu(){this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_ADMIN)&&(this.contextMenuOption={custom:!0,items:'<div class="custom_menu"><div class="plus-symbol"></div>\n                        <div class="deviceText">Device</div><div class="addText">ADD</div>\n                        <div class="additem">\n                        <div class="scanneritem">Add SCANNER</div>\n                        <div class="camitem">Add IPCAM</div></div></div>',dx:-75,animation:"fade"},this.map.on("contextmenu",e=>{this.contextCoordinate=e.coordinate,this.map.closeMenu(),this.map.setMenu(this.contextMenuOption).openMenu(e.coordinate),document.getElementsByClassName("scanneritem")[0].onclick=()=>{this.handleAddHub(e.coordinate)},document.getElementsByClassName("camitem")[0].onclick=()=>{this.handleAddIPCam(e.coordinate)}}))},loadDetectedGadgets(){this.services.getDetectBeaconList(e=>{this._.forEach(e,e=>{this._handleDetectedGadgets(e)}),console.log("Sucess to detect gadgets")})},loadItems(e){this.services.getBeacons(e.product_id,e=>{console.log("Success to get Beacons",e),this.$store.commit("addGadgets",e),this.services.getHubs(e=>{console.log("Success to get Hubs",e),this._.forEach(e,e=>{this.$store.commit("addHub",e),this._.isEmpty(e.custom)||this._.isEmpty(e.custom.map_location)||this.drawHub(e.id,e.custom.map_location,!0)}),this.loadDetectedGadgets()})}),this.services.getIpcams(e=>{console.log("Success to get Ipcams",e),this._.forEach(e,e=>{this.$store.commit("addIpcam",e)}),this.drawIpCams(e,!0)})},drawItems(){const e=this.$store.getters.getHubs,t=this.$store.getters.getIpCams;this.removeGadgetItems();const i=new Date/1e3;if(this._.forEach(this.markerMap.hubs,(e,t)=>{var s=this.$store.getters.getGadgetListDetectedByOneHub(t);this._.forEach(s,(e,t)=>{i-e._t<15&&this.$store.commit("removeDetectedGadgetWithHub",e)})}),this.hasSameGadget(),this._.forEach(e,e=>{this._.isEmpty(e.custom)||this._.isEmpty(e.custom.map_location)||(this.drawHub(e.id,e.custom.map_location,!0),this.drawWorkers(e.id,e.custom.map_location))}),this.hubInfoWindow){const e=this.getHubInfoWindowContent(this.hubInfoWindow.id),t=document.getElementById("worker-info-panel");t&&(t.innerHTML=e.context,document.getElementById("worker-info-count").innerText=e.count,this.registerGadgetHandlerInHubInfoWindow())}if(this.ipcamInfoWindow){const e=this.getIpcamInfoWindowContent(this.ipcamInfoWindow.id),t=document.getElementById("ipcamContent");t&&(t.innerHTML=e.content)}this.drawIpCams(t,!0)},handleAddHub(e){this.showhubList(e,t=>{this.map.closeMenu(t);let i=this.$store.getters.getHub(t);i.custom.map_location={x:e.x,y:e.y},this.$store.commit("updateHubData",i),this.drawHub(t,this.contextCoordinate,!1)})},_updateHubData(e,t){this.services.updateData(e,window.CONSTANTS.PRODUCT_KIND.HUB,e=>{t(e)})},_updateGadgetData(e,t){this.services.updateData(e,window.CONSTANTS.PRODUCT_KIND.MIBSSKEC,t)},showhubList(e,t){const i=this.$store.getters.getHubs;this.options.items=[];let s='<div class="custom_menu"><div class="plus-symbol"></div>\n                            <div class="addText">Scanner</div>\n                            <div class="additem"></div></div>';if(this.map.setMenu({custom:!0,items:s}).openMenu(e),this._.forEach(i,(e,i)=>{if(!this._.has(this.markerMap.hubs,e.id)){let s=document.createElement("div");s.id=`hubitem${i}`,s.innerText=e.name,s.onclick=()=>{t(e.id)},document.getElementsByClassName("additem")[0].appendChild(s)}}),!document.getElementsByClassName("additem")[0].children.length){let e=document.createElement("div");e.className="noScanner",e.innerText="No Scanner",document.getElementsByClassName("additem")[0].appendChild(e)}},drawHub(e,t,i){let s=null,o=this.$store.getters.getHub(e);if(this._.has(this.markerMap.hubs,e))this.markerMap.hubs[e]._coordinates.x!==t.x&&this.markerMap.hubs[e]._coordinates.y!==t.y&&(s=this.markerMap.hubs[e],s.removeInfoWindow(),s.setCoordinates(t),this.markerMap.hubs[e]=s);else{this.drawnGadgetList[e]=[],this.zoomLv=this.map.getZoom()/11*50,s=new r["d"]([t.x,t.y],{symbol:{markerFile:`${window.CONSTANTS.URL.BASE_IMG}icon-hub-tab1.svg`,markerWidth:this.zoomLv,markerHeight:this.zoomLv},draggable:this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_ADMIN)});let a=this._.first(o.tags);window.CONSTANTS.IS_MOCK&&(a=parseInt(a)-100,a=a.toString()),a&&"3"!==a&&"0"!==a?"1"===a?(s.addTo(this.hubAT1Layer),this.markerMap.hubs[e]=s):"2"===a&&(s.addTo(this.hubAT2Layer),this.markerMap.hubs[e]=s):(s.addTo(this.hubLayer),this.markerMap.hubs[e]=s),this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_ADMIN)&&(o.status||s.updateSymbol({markerFile:`${window.CONSTANTS.URL.BASE_IMG}icon-hub1.svg`}),o.custom.map_location={x:t.x,y:t.y},this.$store.commit("updateHubData",o),i||this._updateHubData([o],e=>{this._.isEmpty(e)?this.$store.commit("updateHubData",o):this.sweetbox.fire("Sorry, Hub location update failed")}),s.on("click",()=>{this.showHubInfoWindow(e,s)}),s.on("contextMenu",()=>{s.closeInfoWindow(),this.showContextMenu(e,0,s)}),s.on("dragstart",()=>{s.closeInfoWindow()}),s.on("dragend",t=>{o.custom.map_location={x:t.coordinate.x,y:t.coordinate.y},this.$store.commit("updateHubData",o),this.hasSameGadget(),this.drawWorkers(e,t.coordinate),this._.has(this.hubSetIntervalData,e)||this.setHubTimeOut(e)}),this._.has(o.custom,"is_counted_hub")?o.custom.is_counted_hub&&s.updateSymbol({markerFile:`${window.CONSTANTS.URL.BASE_IMG}icon-hub-tab10.svg`}):o.custom.is_counted_hub=!1),this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_NORMAL)?s.on("click",()=>{this.showHubInfoWindow(e,s)}):s.hide()}},setHubTimeOut(e){this.hubSetIntervalData[e]=Object(D["setTimeout"])(()=>{var t=this.$store.getters.getHub(e);this.markerMap.hubs[e];this._.has(t.custom,"map_location")&&this._updateHubData([t],t=>{this._.isEmpty(t)?delete this.hubSetIntervalData[e]:this.sweetbox.fire("Sorry, Hub location update failed")})},3e3)},removeHubMarker(e){let t=this.markerMap.hubs[e];this.$store.getters.getdetectedGadgetList;if(this._.isEmpty(t))console.warn(`Failed to remove hub marker, cannot find marker by given id: ${e}`);else{let i=this._.clone(this.$store.getters.getHub(e));t.remove(),delete this.markerMap.hubs[e],!this._.isEmpty(i)&&i.custom.map_location?(delete i.custom.map_location,delete i.custom.is_counted_hub,delete this.drawnGadgetList[e],this._updateHubData([i],t=>{this._.isEmpty(t)?(this.$store.commit("updateHubData",i),this.removeGadgetMarkersWhenHubIsMoved(e)):this.sweetbox.fire("Sorry, Hub location update failed")}),console.debug("success to remove hubmarker")):console.warn(`Failed to clear hub location, cannot found hub model by given id: ${e}`)}this.hasSameGadget(),this._.forEach(this.markerMap.hubs,(e,t)=>{this.drawnGadgetList[t]=[],this.drawWorkers(t,this.markerMap.hubs[t]._coordinates)})},showHubInfoWindow(e,t){let i={},s="",o=this.$store.getters.getHub(e);s=o.custom.is_counted_hub?"ON":"OFF",i=this.getHubInfoWindowContent(e),t.setInfoWindow({content:`<div class="worker_menu">\n                        <div class="worker">\n                        <div class="workerId">${i.updatedData}</div>\n                        <div class="workerValue">\n                        <div class="workerkey">WORKER</div><div class="workerCount" id="worker-info-count">${i.count}</div></div>\n                        <div class="forcount">For Counting</div>\n                        <label class="moi-onoff-toggle-hub">\n                        <input class="moi-toggle-button-hub" type="checkbox">\n                        <span class="moi-toggle-slider-hub round-hub">${s}</span>\n                        </label>\n                        </div>\n                        <div id="worker-info-panel" class="workerInfo">${i.context}</div>\n                        <div class="close-button-custom"></div></div></div>`,width:350,custom:!0,autoPan:!1,dy:-300}),t.openInfoWindow(),this.hubInfoWindow={id:e,item:t._infoWindow},document.getElementsByClassName("moi-toggle-button-hub")[0].checked=!!o.custom.is_counted_hub,document.getElementsByClassName("moi-toggle-button-hub")[0].disabled=!this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_ADMIN),this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_ADMIN)&&(document.getElementsByClassName("moi-toggle-button-hub")[0].onchange=()=>{o.custom.is_counted_hub=!!document.getElementsByClassName("moi-toggle-button-hub")[0].checked;let e=`${window.CONSTANTS.URL.BASE_IMG}icon-hub-tab1.svg`;document.getElementsByClassName("moi-toggle-slider-hub")[0].innerText="OFF",o.custom.is_counted_hub&&(document.getElementsByClassName("moi-toggle-slider-hub")[0].innerText="ON",e=`${window.CONSTANTS.URL.BASE_IMG}icon-hub-tab10.svg`);let t=this.markerMap.hubs[o.id];t&&t.updateSymbol({markerFile:e}),this._updateHubData([o],e=>{this._.isEmpty(e)?this.$store.commit("updateHubData",o):this.sweetbox.fire("Sorry, Hub location update failed")})}),this.registerGadgetHandlerInHubInfoWindow(),this._.last(document.getElementsByClassName("close-button-custom")).onclick=()=>{t.removeInfoWindow()},this.hubInfoWindow.item.on("remove",()=>{this.hubInfoWindow=null})},startDetector(){this.beaconDetector.isRunning()||this.beaconDetector.start()},stopDetector(){this.beaconDetector.isRunning()&&this.beaconDetector.stop()},drawWorker(e,t){let i=null,s=[],o=this.$store.getters.getDetectedGadget(e.gid),a=0,n={},d=null;if(o){if(this._.isString(o.custom)||this._.isEmpty(o.custom.map_location)?s.push(t.x,t.y-3*.1):s.push(o.custom.map_location.x,o.custom.map_location.y),this.drawnGadgetList[e.hid]&&this.drawnGadgetList[e.hid].push(e.gid),this.bcnsData[o.gid])i=this.bcnsData[o.gid].marker,i.removeInfoWindow(),this._setBeaconOpacity(i,600,1),i.setCoordinates(s);else{let e=`${window.CONSTANTS.URL.BASE_IMG}lostTag.svg`;this._.isEmpty(o.tags)?d=this.lostTagWorkerLayer:(a=this._.first(o.tags),window.CONSTANTS.IS_MOCK?parseInt(a)<100?d=this.lostTagWorkerLayer:(a=parseInt(a)-100,a=a.toString(),d=this.workerLayer[a]):d=a>=100?this.lostTagWorkerLayer:this.workerLayer[a],e=`${window.CONSTANTS.URL.BASE_IMG}icon-worker${a}-tab.svg`),n=this._getMarkerSize(a),i=new r["d"](s,{symbol:{markerFile:e,markerWidth:n.width,markerHeight:n.height,markerOpacity:0,markerDy:10,markerLineWidth:3}}).addTo(d),this._setBeaconOpacity(i,600,1),this.bcnsData[o.gid]={marker:i,tags:a},i.on("click",()=>{this.showGadgetInFoWindow(o,this.bcnsData[o.gid].marker)})}this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_NORMAL)||(!i.isVisible()&&o.custom.is_visible_moi?i.show():i.isVisible()&&!o.custom.is_visible_moi&&i.hide())}},drawWorkers(e,t){let i=this.$store.getters.getGadgetListDetectedByOneHub(e);this._.forEach(i,e=>{this.drawWorker(e,t)})},showGadgetInFoWindow(e,t){let i=null,s=this.$store.getters.getHubListDetectOneGadget(e.gid),o=this._.keys(s),a="",n=0,d=null;this.gadgetInfoWindow&&(this._.isEqual(this.gadgetInfoWindow.id,e.gid)||this.gadgetInfoWindow.item.remove()),this._.isEmpty(e.tags)||(window.CONSTANTS.IS_MOCK?(d=parseInt(this._.first(e.tags))-100,d=d.toString(),i=window.CONSTANTS.GADGET_INFO[d]):(d=this._.first(e.tags),i=window.CONSTANTS.GADGET_INFO[d])),this._.isEmpty(o)||this._.forEach(o,e=>{const t=this.$store.getters.getHub(e);t&&this._.has(t.custom,"map_location")&&(a+=`<div class="scannerName" id="${t.id}-scanner" title="${t.name}">${t.name}</div>`,n++)});let c=`<div class="bcns">\n                        <div class="bcnsInfo1">\n                        <div class="bcnskey1">NAME</div>\n                        <div class="bcnName1 bcnName" title="${e.name}">${e.name}</div>\n                        <div class="bcnskey1">KIND</div>\n                        <div class="bcnName1 bcnKind" title="${i}">${_.isEmpty(i)?"Not Selected":i}</div>\n                        <div id="${e.gid}name-data" class="scannerData">SCANNER(${n})</div>\n                        <div class="scannerNameList">${a}</div></div>\n                        <div id="${e.gid}loading-panel" class="loading-panel"></div>\n                        <div id="${e.gid}loader" class="loader"><div></div><div></div><div></div><div></div></div>\n                        <img id="${e.gid}img" class="bcnsImg1" src="${window.CONSTANTS.URL.BASE_IMG}item${d}.png"></img>\n                        <div class="close-button-custom"></div></div></div>`,h={content:c,width:400,bottom:11,custom:!0,dy:-250,autoPan:!1,autoCloseOn:!0,autoOpenOn:!0};this.gadgetInfoWindow={id:e.gid,item:new r["f"].InfoWindow(h)},this.gadgetInfoWindow.item.addTo(this.map).show(this.map.getCenter()),t.setZIndex(4),t.flash(500,15,()=>{t.setZIndex(1)}),this._.isString(e.custom)&&(e.custom={}),this._registerGadgetInfoWindowHandler(e),this.registerHubHandlerInGadgetInfoWindow()},removeGadgetMarkersWhenHubIsMoved(e){const t=this.$store.getters.getGadgetListDetectedByOneHub(e);this._.isEmpty(t)||this._.forEach(t,e=>{const t=this.$store.getters.getDetectedGadget(e.gid),i=this._.keys(this.markerMap.hubs),s=this._.intersection(i,t.hubIdList);s.length<=1&&(this.bcnsData[e.gid].marker.remove(),delete this.bcnsData[e.gid],this.$store.commit("removeGadgetLocation",e.gid))})},removeGadget(e){this._.has(this.bcnsData,e)&&(this.bcnsData[e].marker.remove(),delete this.bcnsData[e]),this.$store.commit("removeGadget",e)},setGadgetLocation(e){let t={},i={},s={},o=0,a=0,n=0,d=null,c=null,r=0,h=0;t=this._.sortBy(e,["_t"]),t=this._.reverse(t),this._.forEach(t,e=>{let t=this.$store.getters.getHub(e.hid);this._.has(t.custom,"map_location")&&h<2&&(i[e.hid]=this._.clone(t.custom.map_location),i[e.hid].dist=e.dist,i[e.hid].gid=e.gid,h++)}),2===this._.size(i)&&(this._.forEach(i,(e,t)=>{0===r?d=e:c=e,this.isNumber(e.dist)&&(n+=e.dist),r++}),o=(d.x*c.dist+c.x*d.dist)/n,a=(d.y*c.dist+c.y*d.dist)/n),this._.isEqual(o,0)||(this._.forEach(i,(e,t)=>{s={hid:t,gid:e.gid,x:o,y:a,zoomLv:this.map.getZoom()/11*25}}),this.$store.commit("addGadgetLocation",s))},hasSameGadget(){const e=this.$store.getters.getdetectedGadgetList,t={},i=this._.keys(this.markerMap.hubs);this._.forEach(e,(e,s)=>{const o=this._.intersection(i,e.hubIdList);o.length>1?(t[s]={},t[s]=o):1===o.length&&this.$store.commit("removeGadgetLocation",s)});let s=this._.keys(t).length;s>0&&this._.forEach(t,(e,t)=>{var i=this.$store.getters.getHubListDetectOneGadget(t);this.setGadgetLocation(i)})},handleAddIPCam(e){this.showIpCamList(e,e=>{this.map.closeMenu(e),this.drawIpcam(e,this.contextCoordinate,!1)})},showIpCamList(e,t){const i=this.$store.getters.getIpCams;this.options.items=[];let s='<div class="custom_menu"><div class="plus-symbol"></div>\n                            <div class="addText">IPCAM</div>\n                            <div class="additem"></div></div>';if(this.map.setMenu({custom:!0,items:s}).openMenu(e),this._.isEmpty(i)||this._.forEach(i,(e,i)=>{if(!this._.has(this.markerMap.cams,e.id)){let s=document.createElement("div");s.id=`camitem${i}`,s.innerText=e.name,s.onclick=()=>{t(e.id)},document.getElementsByClassName("additem")[0].appendChild(s)}}),!document.getElementsByClassName("additem")[0].children.length){let e=document.createElement("div");e.className="noIpcam",e.innerText="No Ipcam",document.getElementsByClassName("additem")[0].appendChild(e)}},drawIpCams(e,t){this._.forEach(e,e=>{this._.isEmpty(e.custom)||this._.isEmpty(e.custom.map_location)||this.drawIpcam(e.id,e.custom.map_location,t)})},drawIpcam(e,t,i){let s=null;var o=this.$store.getters.getIpCam(e);this.zoomLv=this.map.getZoom()/11*50;let a=`${window.CONSTANTS.URL.BASE_IMG}icon-ipcam-default.svg`;if(o.custom.is_visible_moi&&(a=`${window.CONSTANTS.URL.BASE_IMG}icon-ipcam-checked.svg`),this._.has(this.markerMap.cams,e)){if(this.markerMap.cams[e]._coordinates.x!==t.x&&this.markerMap.cams[e]._coordinates.y!==t.y){if(s=this.markerMap.cams[e],this.ipcamInfoWindow&&!this._.isEqual(this.ipcamInfoWindow.id,e)){const e=this.ipcamInfoWindow.id;this.ipcamInfoWindow=null,s.removeInfoWindow(),this.closeIpcamStreaming([e],e=>{this._.forEach(e,(e,t)=>{this._.isEmpty(e)?console.log("success to disconnect ipcam streaming"):this.sweetbox.fire("Sorry, disconnect Ipcam Streaming failed")})})}s.setCoordinates(t),this.markerMap.cams[e]=s}}else s=new r["d"]([t.x,t.y],{symbol:{markerFile:a,markerWidth:this.zoomLv,markerHeight:this.zoomLv},draggable:this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_ADMIN)}).addTo(this.camLayer),s.on("click",()=>{s.closeInfoWindow(),this.showIpcamWindow(e,s)}),this.markerMap.cams[e]=s,this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_NORMAL)?this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_ADMIN)&&(s.on("contextmenu",()=>{s.closeInfoWindow(),this.showContextMenu(e,1,s)}),s.on("dragstart",()=>{s.closeInfoWindow()}),s.on("dragend",t=>{o.custom.map_location={x:t.coordinate.x,y:t.coordinate.y},this.$store.commit("updateIpcamData",o),this._.has(this.ipcamSetIntervalData,e)||this.setIpcamTimeOut(e)}),o.custom.map_location={x:t.x,y:t.y},i||this._updateIpcamData([o],e=>{this._.isEmpty(e)||this.sweetbox.fire("Sorry, Ipcam location update failed"),this.$store.commit("updateIpcamData",o)})):o.custom&&!o.custom.is_visible_moi&&s.hide()},setIpcamTimeOut(e){this.ipcamSetIntervalData[e]=Object(D["setTimeout"])(()=>{var t=this.$store.getters.getIpCam(e);this.markerMap.cams[e];this._.has(t.custom,"map_location")&&this._updateIpcamData([t],t=>{this._.isEmpty(t)?delete this.ipcamSetIntervalData[e]:this.sweetbox.fire("Sorry, Ipcam location update failed")})},3e3)},showIpcamWindow(e,t){let i=this.$store.getters.getIpCam(e);if(this._.isEmpty(this.infoWindow)||this.infoWindow.remove(),this.ipcamInfoWindow&&!this._.isEqual(this.ipcamInfoWindow.id,e)){const e=this.ipcamInfoWindow.id;this.ipcamInfoWindow=null,t.removeInfoWindow(),this.closeIpcamStreaming([e],e=>{this._.forEach(e,(e,t)=>{this._.isEmpty(e)?console.log("success to disconnect ipcam streaming"):this.sweetbox.fire("Sorry, disconnect Ipcam Streaming failed")})})}if(t.setInfoWindow({content:`<div class="ipcam_menu">\n                    <div id="ipcam-main-container" class="ipcam-container">\n                    <div class="ipcamId">\n                    <div class="ipcamKey">IPCAM</div><div class="ipcamInfo" title="${i.name}">${i.name}</div></div>\n                    </div><div class="ipcam-right-panel">\n                    </div><div class="bottom-shape"></div><div class="close-button"></div></div>`,custom:!0,dy:-403,autoPan:!1}),t.openInfoWindow(),this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_ADMIN)){const e=document.getElementById("ipcam-main-container");if(e){const t=document.createElement("div");t.innerHTML='<div class="moi">MOI System</div>\n                        <label class="moi-onoff-toggle">\n                        <input class="moi-toggle-button" type="checkbox">\n                        <span class="moi-toggle-slider round"></span></label>',e.append(t),document.getElementsByClassName("moi-toggle-button")[0].checked=!!i.custom.is_visible_moi,document.getElementsByClassName("moi-toggle-button")[0].onchange=()=>{i.custom.is_visible_moi=document.getElementsByClassName("moi-toggle-button")[0].checked;let e=`${window.CONSTANTS.URL.BASE_IMG}icon-ipcam-default.svg`;i.custom.is_visible_moi&&(e=`${window.CONSTANTS.URL.BASE_IMG}icon-ipcam-checked.svg`);let t=this.markerMap.cams[i.id];t&&t.updateSymbol({markerFile:e}),this._updateIpcamData([i],()=>{this.$store.commit("updateIpcamData",i)})}}}const s="video_player",o=document.createElement("video");o.setAttribute("id",s),o.setAttribute("controls","controls"),o.setAttribute("class","mediaplayer");const a=document.getElementsByClassName("ipcam-right-panel")[0];a.appendChild(o),this.openIpcamStreaming([e],t=>{let i=this._.first(t);i?this._playStreaming(i[e]):this.sweetbox.fire("Sorry, connect Ipcam Streaming failed")}),this.ipcamInfoWindow={id:e,item:t._infoWindow},this._.last(document.getElementsByClassName("close-button")).onclick=()=>{t.removeInfoWindow()},this.ipcamInfoWindow.item.on("remove",()=>{this.ipcamInfoWindow&&(this.ipcamInfoWindow=null,this.closeIpcamStreaming([e],e=>{this._.forEach(e,(e,t)=>{this._.isEmpty(e)?console.log("success to disconnect ipcam streaming"):this.sweetbox.fire("Sorry, disconnect Ipcam Streaming failed")})}))})},openIpcamStreaming(e,t){this.services.openIpcamStream(e,e=>{t(e)})},closeIpcamStreaming(e,t){this.services.closeIpcamStream(e,e=>{t(e)})},removeIpcamMarker(e){let t=this.markerMap.cams[e];if(this._.isEmpty(t))console.warn(`Failed to remove ipcam marker, cannot found ipcam by given id: ${e}`);else{let i=this._.clone(this.$store.getters.getIpCam(e));t.remove(),delete this.markerMap.cams[e],!this._.isEmpty(i)&&i.custom.map_location?(delete i.custom.map_location,delete i.custom.is_visible_moi,this._updateIpcamData([i],e=>{this._.isEmpty(e)||this.sweetbox.fire("Sorry, Ipcam remove failed")})):console.warn(`Failed to clear ipcam location, cannot found ipcam model by given id: ${e}`)}},_updateIpcamData(e,t){this.services.updateData(e,window.CONSTANTS.PRODUCT_KIND.IPCAM,e=>{t(e)})},filterBeacon(){let e="";this._.forEach(this.gadgetInfoNumber,t=>{e+=`<label class="filterBeacon">\n                            <img id="worker${t}" class="workerImg" src="${window.CONSTANTS.URL.BASE_IMG}icon-worker${t}-tab.svg">\n                            <input class="beaconItem" id="beacon-${t}" type="checkbox"></label>`}),e+='<button id="beacon-filter-Reset-Button" class="beacon-filter-Reset-Button">Reset</button>',this.sweetbox.fire({showCancelButton:!1,showConfirmButton:!1,showCloseButton:!0,titleText:"Choose the beacon to filter",html:e,width:550}),this._.forEach(this.gadgetInfoNumber,e=>{document.getElementById(`beacon-${e}`).checked=!this.workerLayer[e].isVisible(),document.getElementById(`beacon-${e}`).onchange=()=>{const t=document.getElementById(`beacon-${e}`).checked;t?this.workerLayer[e].hide():this.workerLayer[e].show()}}),document.getElementById("beacon-filter-Reset-Button").onclick=()=>{this._.forEach(this.gadgetInfoNumber,e=>{document.getElementById(`beacon-${e}`).checked=0,this.workerLayer[e].show()})}},choiceFilter(){this.sweetbox.fire({titleText:"Choose the item to filter",html:'<button id="filterItemGadget" class="filterGadgetIcon"></button>\n                <button id="filterItemHub" class="filterHubIcon"></button>\n                <button id="filterItemIpcam" class="filterIpcamIcon"></button>\n                <button id="filterItemSpeaker" class="filterSpeakerIcon"></button>',showCancelButton:!1,showConfirmButton:!0,confirmButtonColor:"#3085d6",showCloseButton:!0,width:450}),document.getElementsByClassName("filterHubIcon")[0].onclick=()=>{this.filterItems(1)},document.getElementsByClassName("filterGadgetIcon")[0].onclick=()=>{this.filterBeacon()},1===this.ipcamFilterOn?document.getElementsByClassName("filterIpcamIcon")[0].classList.add("ipcamFilterOn"):document.getElementsByClassName("filterIpcamIcon")[0].classList.remove("ipcamFilterOn"),document.getElementsByClassName("filterIpcamIcon")[0].onclick=()=>{0===this.ipcamFilterOn?(this.camLayer.hide(),this.ipcamFilterOn=1,document.getElementsByClassName("filterIpcamIcon")[0].classList.add("ipcamFilterOn")):(this.camLayer.show(),this.ipcamFilterOn=0,document.getElementsByClassName("filterIpcamIcon")[0].classList.remove("ipcamFilterOn"))},document.getElementsByClassName("filterSpeakerIcon")[0].onclick=()=>{this.sweetbox.close()}},filterItems(e){let t={};1===e&&(t={AT1:this.hubAT1Layer,AT2:this.hubAT2Layer,others:this.hubLayer}),this.sweetbox.mixin({showConfirmButton:!1,showCloseButton:!0,showCancelButton:!1},onclose=()=>{document.getElementsByClassName("swal2-content")[0].classList.remove("filterItems")}).queue([{title:"Choose the Tunnel",html:`<div class="selectTn">\n                            <label id="tn"><input class="filterAT1 item${e}-${e}" type="checkbox">\n                            AT1</label></div>\n                            <div class="selectTn">\n                            <label id="tn"><input class="filterAT2 item${e}-${e+1}" type="checkbox">\n                            AT2</label></div>\n                            <div class="selectTn">\n                            <label id="tn"><input class="filterAll item${e}-${e+2}" type="checkbox">\n                            Portal</label></div>\n                            <button id="filter-Reset-Button" class="filter-Reset-Button">Reset</button>`}]),document.getElementById("filter-Reset-Button").onclick=()=>{document.getElementsByClassName(`item${e}-${e}`)[0].checked=0,document.getElementsByClassName(`item${e}-${e+1}`)[0].checked=0,document.getElementsByClassName(`item${e}-${e+2}`)[0].checked=0,t.AT1.show(),t.AT2.show(),t.others.show()},document.getElementsByClassName(`item${e}-${e}`)[0].checked=!t.AT1.isVisible(),document.getElementsByClassName(`item${e}-${e}`)[0].onchange=()=>{const i=document.getElementsByClassName(`item${e}-${e}`)[0].checked;i?t.AT1.hide():t.AT1.show()},document.getElementsByClassName(`item${e}-${e+1}`)[0].checked=!t.AT2.isVisible(),document.getElementsByClassName(`item${e}-${e+1}`)[0].onchange=()=>{const i=document.getElementsByClassName(`item${e}-${e+1}`)[0].checked;i?t.AT2.hide():t.AT2.show()},document.getElementsByClassName(`item${e}-${e+2}`)[0].checked=!t.others.isVisible(),document.getElementsByClassName(`item${e}-${e+2}`)[0].onchange=()=>{const i=document.getElementsByClassName(`item${e}-${e+2}`)[0].checked;i?t.others.hide():t.others.show()},document.getElementsByClassName("swal2-content")[0].classList.add("filterItems")},filterHubs(e){this.sweetbox.mixin({confirmButtonText:"OK",showCancelButton:!0}).queue([{title:"Choose the Tunnel",html:'<div class="selectTn">\n                            <input class="filterAT1" type="checkbox">\n                            <label id="tn">AT1</label></div>\n                            <div class="selectTn">\n                            <input class="filterAT2" type="checkbox">\n                            <label id="tn">AT2</label></div></div>\n                            <div class="selectTn">\n                            <input class="filterAll" type="checkbox">\n                            <label id="tn">The Other Hub</label></div></div>'}]),document.getElementsByClassName("filterAT1")[0].checked=!this.hubAT1Layer.isVisible(),document.getElementsByClassName("filterAT1")[0].onchange=()=>{this.hubAT1Layer.isVisible()?this.hubAT1Layer.hide():this.hubAT1Layer.show()},document.getElementsByClassName("filterAT2")[0].checked=!this.hubAT2Layer.isVisible(),document.getElementsByClassName("filterAT2")[0].onchange=()=>{this.hubAT2Layer.isVisible()?this.hubAT2Layer.hide():this.hubAT2Layer.show()},document.getElementsByClassName("filterAllHub")[0].checked=!this.hubLayer.isVisible(),document.getElementsByClassName("filterAllHub")[0].onchange=()=>{this.hubLayer.isVisible()?this.hubLayer.hide():this.hubLayer.show()}},showLoading(){this.$emit("map-load",!0)},hideLoading(){this.$emit("map-load",!1)},showContextMenu(e,t,i){var s="",o="",a=null;switch(t){case window.CONSTANTS.CONTEXT_TYPE.SCANNER:var n=this.$store.getters.getHub(e);s="Scanner",n&&(o=n.name),a=this.removeHubMarker;break;case window.CONSTANTS.CONTEXT_TYPE.IPCAM:var d=this.$store.getters.getIpCam(e);s="IPCam",d&&(o=d.name),a=this.removeIpcamMarker;break}i.setMenu({items:`<div class="context-menu-container ${s.toLowerCase()}">\n                    <div class="context-menu-top-panel"><div class="context-menu-text-wrapper">\n                    <div class="context-menu-type-text">${s}</div>\n                    <div class="context-menu-name-text">${o}</div></div></div>\n                    <div class="context-menu-bottom-panel">\n                    <div id="move-button" class="context-menu-button-frame ${s.toLowerCase()}"><div class="context-menu-button-panel">\n                    <div id="move-button-text" class="context-menu-button-text">${"Move "+s.toLowerCase()}</div></div></div>\n                    <div id="remove-button" class="context-menu-button-frame ${s.toLowerCase()}"><div class="context-menu-button-panel">\n                    <div id="remove-button-text" class="context-menu-button-text">${"Remove "+s.toLowerCase()}</div></div></div></div></div>`,width:350,custom:!0,dy:-120,animation:"fade",dx:-90}).openMenu(),document.getElementById("remove-button").onclick=function(){a(e),i.closeMenu()}},removeItems(){this.sweetbox.fire({title:"Are you sure?",text:"You won't be able to revert this!",width:230,showCloseButton:!0,showCancelButton:!0,reverseButtons:!0,cancelButtonColor:"#d33"}).then(e=>{e.value&&(this.isRemoveAll=!0,this.removeHubItems(),this.removeGadgetItems(),this.removeIpcamItems(),this.isRemoveAll=!1)})},removeHubItems(){let e=[];this._.forEach(this.markerMap.hubs,(t,i)=>{let s=this._.clone(this.$store.getters.getHub(i));this._.isEmpty(s)||(delete s.custom.map_location,delete s.custom.is_counted_hub,this.$store.commit("updateHubData",s),this.markerMap.hubs[i].remove(),delete this.markerMap.hubs[i],e.push(s))}),e&&this._updateHubData(e,e=>{console.debug("Succeed to remove hub data")})},removeGadgetItems(){this.bcnsData&&this._.forEach(this.bcnsData,(e,t)=>{e.marker.remove(),this.$store.commit("removeGadgetLocation",t)}),this.drawnGadgetList={},this.bcnsData={}},removeIpcamItems(){let e=[];this._.forEach(this.markerMap.cams,(t,i)=>{let s=this._.clone(this.$store.getters.getIpCam(i));this._.isEmpty(s)||(delete s.custom.map_location,delete s.custom.is_visible_moi,this.$store.commit("updateIpcamData",s),this.markerMap.cams[i].remove(),delete this.markerMap.cams[i],e.push(s))}),e&&this._updateIpcamData(e,e=>{console.debug("Succeed to remove ipcam data")}),this._.forEach(this.markerMap.cams,(e,t)=>{this.removeIpcamMarker(t)})},getHubInfoWindowContent(e){const t=this.$store.getters.getGadgetListDetectedByOneHub(e),i=this.$store.getters.getHub(e);let s="",o="",a=0;return s+=`<div class="workerkey">SCANNER</div><div class="hubInfo" title="${i.name}">${i.name}</div>`,this._.forEach(t,t=>{if(this._.includes(this.drawnGadgetList[e],t.gid)){var i=this.$store.getters.getdetectedGadgetName(t.gid);if(i){const e=new Date(1e3*t._t).toLocaleTimeString("eu");o+=`<div class="workerInfo-content" id="${t.gid}">\n                                    <div class="workerInfo-wrapper">\n                                    <div class="workerInfo-name" id="${t.gid}-detectedBeaconName">${i}</div>\n                                    <span class="workerInfo-time" id="${t.gid}-detectedBeaconTime">Today ${e}</span></div></div>`,a++}}}),a<1&&(o='<div class="workerInfo-empty">Theres no beacon</div>'),{updatedData:s,context:o,count:a}},registerGadgetHandlerInHubInfoWindow(){if(this.hubInfoWindow){const e=this.$store.getters.getGadgetListDetectedByOneHub(this.hubInfoWindow.id);this._.forEach(e,e=>{const t=document.getElementById(e.gid);if(t){const i=this.$store.getters.getdetectedGadgetList[e.gid];t.onclick=()=>{this.bcnsData[e.gid]&&this.showGadgetInFoWindow(i,this.bcnsData[e.gid].marker)}}})}},registerHubHandlerInGadgetInfoWindow(){if(this.gadgetInfoWindow){const e=this.$store.getters.getHubListDetectOneGadget(this.gadgetInfoWindow.id);this._.forEach(e,e=>{const t=document.getElementById(`${e.hid}-scanner`);if(t){this.$store.getters.getHub(e.hid);t.onclick=()=>{this.markerMap.hubs[e.hid]&&this.showHubInfoWindow(e.hid,this.markerMap.hubs[e.hid])}}})}},isShowingByStage(e){return this.info.stage<=e},_getMarkerSize(e){let t=this.zoomLv,i=this.zoomLv;return this._.includes(this.tags.xll,e)?(i*=2,this._.isEqual(e,"8")?t*=3.1:t*=3.7):this._.includes(this.tags.xl,e)?(t*=2,i*=1.6):this._.includes(this.tags.l,e)?(i*=1.4,this._.isEqual(e,"9")||this._.isEqual(e,"11")?t*=1.45:this._.isEqual(e,"4")||this._.isEqual(e,"5")?t*=1.8:t*=1.4):this._.isEqual(e,"17")||this._.isEqual(e,"10")?t*=1.2:(this._.isEqual(e,"12"),t*=1.1),{width:t,height:i}},_registerGadgetInfoWindowHandler(e){const t=document.getElementById(`${e.gid}loader`),i=document.getElementById(`${e.gid}loading-panel`);let s=this.$store.getters.getGadget(e.gid);if(s&&this._.has(s,"img_url")){let t=document.getElementById(`${e.gid}img`);url&&!this._.isEmpty(t)&&(t.src=url)}t&&(t.remove(),i.remove());const o=document.getElementById(`${e.gid}name-data`),a=document.getElementsByClassName("beacon-moi-container")[0];if(o&&!a){const t=document.createElement("div");t.className="beacon-moi-container",t.innerHTML=`<div class="bcnskey1">MOI System</div>\n                    <label class="moi-onoff-toggle beacon">\n                    <input id="${e.gid}-moi-button" class="moi-toggle-button beacon" type="checkbox">\n                    <span id ="${e.gid}-slider" class="moi-toggle-slider beacon round"></span></label>`,o.before(t),document.getElementById(`${e.gid}-moi-button`).disabled=!this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_ADMIN),document.getElementById(`${e.gid}-moi-button`).checked=!!e.custom.is_visible_moi}this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_ADMIN)&&(this._.has(e.custom,"is_visible_moi")&&e.custom.is_visible_moi?document.getElementById(`${e.gid}-slider`).innerText="ON":document.getElementById(`${e.gid}-slider`).innerText="OFF");const n=document.getElementById(`${e.gid}-moi-button`),d=document.getElementsByClassName("close-button-custom")[0];n&&(n.onchange=()=>{const t=this.$store.getters.getGadget(e.gid),i=n.checked;document.getElementById(`${e.gid}-slider`).innerText="OFF",i&&(document.getElementById(`${e.gid}-slider`).innerText="ON"),t.custom={is_visible_moi:i},this._updateGadgetData([t],()=>{this.$store.commit("updateGadgetMoiData",{id:t.id,isVisible:i}),console.log("Succeed to update gadget data")},e=>{console.log("Failed to update gadget data")})}),d&&(d.onclick=()=>{this.gadgetInfoWindow.item.remove()}),this.gadgetInfoWindow.item.on("remove",()=>{this.gadgetInfoWindow=null})},_setBeaconOpacity(e,t,i,s){const o={symbol:{markerOpacity:i}};e.animate(o,{duration:t,easing:"inAndOut"},e=>{"finished"===e.state.playState&&s&&s()})},_playStreaming(e){const t=new G.a,i=document.getElementById("video_player");i&&(t.attachMedia(i),t.on(G.a.Events.MANIFEST_PARSED,()=>{i.play()}),t.loadSource(e),t.on(G.a.Events.ERROR,(e,t)=>{console.log("Failed to load ipcam streaming")}))},_handleAdded(e){this.isScanner(e.kind)?this._handleAddHub(e.v):this.isIpcam(e.kind)?this._handleAddIpcam(e.v):this._handleAddGadget(e.v)},_handleAddHub(e){this.$store.commit("addHub",e)},_handleAddGadget(e){this.$store.commit("addGadget",e)},_handleAddIpcam(e){this.$store.commit("addIpcam",e)},_handleUpdated(e){this.isScanner(e.kind)?this._handleUpdatedHub(e.v):this.isIpcam(e.kind)?this._handleUpdatedIpcam(e.v):this._handleUpdatedBeacon(e.v)},_handleUpdatedHub(e){let t=this.markerMap.hubs[e.id],i=this._.clone(this.$store.getters.getHub(e.id));if(this._.extend(i,e),this.$store.commit("updateHubData",i),e.custom){if(this._.has(e.custom,"map_location"))this.drawHub(e.id,e.custom.map_location,!0),this.hasSameGadget(),this.drawWorkers(e.id,e.custom.map_location);else{let t=this.markerMap.hubs[e.id];t&&(t.remove(),delete this.markerMap.hubs[e.id])}this._.has(e.custom,"is_counted_hub")&&t&&(e.custom.is_counted_hub?t.updateSymbol({markerFile:`${window.CONSTANTS.URL.BASE_IMG}icon-hub-tab10.svg`}):i.status?t.updateSymbol({markerFile:`${window.CONSTANTS.URL.BASE_IMG}icon-hub-tab1.svg`}):t.updateSymbol({markerFile:`${window.CONSTANTS.URL.BASE_IMG}icon-hub1.svg`}),this.hubInfoWindow&&this._.isEqual(this.hubInfoWindow.id,e.id)&&(document.getElementsByClassName("moi-toggle-button-hub")[0].checked=!!e.custom.is_counted_hub,document.getElementsByClassName("moi-toggle-slider-hub")[0].innerText="OFF",e.custom.is_counted_hub&&(document.getElementsByClassName("moi-toggle-slider-hub")[0].innerText="ON")))}if(e.tags){let t=this.$store.getters.getHub(e.id),i=this.markerMap.hubs[e.id];i&&(i.remove(),delete this.markerMap.hubs[e.id],this.drawHub(e.id,t.custom.map_location,!0))}if(e.name){if(this.hubInfoWindow&&this._.isEqual(this.hubInfoWindow.id,e.id)){let t=document.getElementsByClassName("hubInfo")[0];t.title=e.name,t.innerText=e.name}if(this.gadgetInfoWindow){const t=this.$store.getters.getHubListDetectOneGadget(this.gadgetInfoWindow.id);if(t&&this._.includes(this._.keys(t),e.id)){let t=document.getElementById(`${e.id}-scanner`);t&&(t.title=e.name,t.innerText=e.name)}}}},_handleUpdatedIpcam(e){let t=this.markerMap.cams[e.id],i=this._.clone(this.$store.getters.getIpCam(e.id));if(e.custom){if(this._.has(e.custom,"map_location"))this.drawIpcam(e.id,e.custom.map_location,!0);else{let t=this.markerMap.cams[e.id];t&&(t.remove(),delete this.markerMap.cams[e.id])}if(this._.has(e.custom,"is_visible_moi")){if(t){let i=`${window.CONSTANTS.URL.BASE_IMG}icon-ipcam-default.svg`;e.custom.is_visible_moi&&(i=`${window.CONSTANTS.URL.BASE_IMG}icon-ipcam-checked.svg`),t.updateSymbol({markerFile:i}),this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_NORMAL)||(!t.isVisible()&&e.custom.is_visible_moi?t.show():t.isVisible()&&!e.custom.is_visible_moi&&t.hide())}this.ipcamInfoWindow&&this._.isEqual(this.ipcamInfoWindow.id,e.id)&&(document.getElementsByClassName("moi-toggle-button")[0].checked=!!e.custom.is_visible_moi)}}if(e.name&&this.ipcamInfoWindow&&this._.isEqual(this.ipcamInfoWindow.id,e.id)){this.getIpcamInfoWindowContent(e.id);const t=document.getElementsByClassName("ipcamInfo")[0];t&&(t.title=e.name,t.innerText=e.name)}this._.extend(i,e),this.$store.commit("updateIpcamData",i)},_handleUpdatedBeacon(e){let t=this.bcnsData[e.id];const i=this._.clone(this.$store.getters.getGadget(e.id));if(this._.extend(i,e),this.$store.commit("updateGadgetData",i),t){let s=t.marker;if(e.tags){let o=this._.first(e.tags);if(window.CONSTANTS.IS_MOCK&&(o=parseInt(o)-100,o=o.toString()),s){const i=t.marker._coordinates;s.remove(),delete this.bcnsData[e.id],this.drawWorker({gid:e.id},i)}if(this.gadgetInfoWindow&&this._.isEqual(this.gadgetInfoWindow.id,e.id)){const e=window.CONSTANTS.GADGET_INFO[o];document.getElementsByClassName("bcnKind")[0].innerText=e,document.getElementById(`${i.id}img`).src=`${window.CONSTANTS.URL.BASE_IMG}item${o}.png`}this._.includes(this.setFilteredBeacons,o)?s.hide():s.show()}if(e.custom&&(this.$store.commit("updateGadgetMoiData",{id:e.id,isVisible:e.custom.is_visible_moi}),this.isShowingByStage(window.CONSTANTS.USER_STAGE.SK_NORMAL)||(!s.isVisible()&&e.custom.is_visible_moi?s.show():s.isVisible()&&!e.custom.is_visible_moi&&s.hide()),this.gadgetInfoWindow&&this._.isEqual(this.gadgetInfoWindow.id,e.id))){const t=document.getElementById(`${i.id}-moi-button`);t.checked=!!e.custom.is_visible_moi,document.getElementById(`${i.id}-slider`).innerText="OFF",e.custom.is_visible_moi&&(document.getElementById(`${i.id}-slider`).innerText="ON")}if(e.name){if(this.gadgetInfoWindow&&this._.isEqual(this.gadgetInfoWindow.id,e.id)){let t=document.getElementsByClassName("bcnName")[0];t.title=e.name,t.innerText=e.name}if(this.hubInfoWindow){const t=this.$store.getters.getGadgetListDetectedByOneHub(this.hubInfoWindow.id);if(t&&this._.includes(t,e.id)){let i=document.getElementById(`${e.id}-detectedBeaconName`),s=document.getElementById(`${e.id}-detectedBeaconTime`),o=new Date(1e3*t[e.id]._t).toLocaleTimeString("eu");i&&s&&(i.innerText=e.name,s.innerText=`Today ${o}`)}}}}},_handleRemoved(e){this.isScanner(e.kind)?this._handleHubRemoved(e.v):this.isIpcam(e.kind)?this._handleIpcamRemoved(e.v):this._handleGadgetRemoved(e.v)},_handleHubRemoved(e){this.$store.commit("removeHub",e.id),this.removeHubMarker(e.id)},_handleIpcamRemoved(e){this.$store.commit("removeIpcam",e.id),this.removeIpcamMarker(e.id)},_handleGadgetRemoved(e){this.$store.commit("removeGadget",e.id),this.removeGadget(e.id)},_handleDetectedGadgets(e){const t=new Date/1e3;this._.forEach(e,e=>{if(t-e._t<50){this.$store.commit("addDetectedHubGadget",e),this.hasSameGadget();const t=this.markerMap.hubs[e.hid];if(t&&this.drawWorker(e,t._coordinates),this.hubInfoWindow){const e=this.getHubInfoWindowContent(this.hubInfoWindow.id),t=document.getElementById("worker-info-panel");t&&(t.innerHTML=e.context,document.getElementById("worker-info-count").innerText=e.count,this.registerGadgetHandlerInHubInfoWindow())}}})},_handleDataRefresh(){const e=new Date/1e3;this._.forEach(this.markerMap.hubs,(t,i)=>{var s=this.$store.getters.getGadgetListDetectedByOneHub(i);this._.forEach(s,(t,i)=>{const s=e-t._t;if(s>25&&s<50)this.bcnsData[i]&&this._setBeaconOpacity(this.bcnsData[i].marker,300,.5);else if(s>=50){this.$store.commit("removeDetectedGadgetWithHub",t),this.$store.commit("removeGadgetLocation",i);const e=this.bcnsData[i];e&&this._setBeaconOpacity(e.marker,600,0,()=>{e.marker.remove(),e.marker.removeInfoWindow(),delete this.bcnsData[i]})}})}),this.hasSameGadget()},_handleHubOnline(e){let t=this.markerMap.hubs[e.id],i=this._.clone(this.$store.getters.getHub(e.id));i.status=1,this.$store.commit("updateHubData",i),t&&t.updateSymbol({markerFile:`${window.CONSTANTS.URL.BASE_IMG}icon-hub-tab1.svg`})},_handleHubOffline(e){let t=this.markerMap.hubs[e.id],i=this._.clone(this.$store.getters.getHub(e.id));i.status=0,this.$store.commit("updateHubData",i),t&&t.updateSymbol({markerFile:`${window.CONSTANTS.URL.BASE_IMG}icon-hub1.svg`})},_handleReopenStream(e){this.ipcamInfoWindow&&this._.forEach(e,e=>{const t=_.first(_.keys(e));this.ipcamInfoWindow.id===t&&this._playStreaming(e[t])})},_subscribe(){this.services.subscribe({added:e=>{this.isRemoveAll||this._handleAdded(e)},updated:e=>{this.isRemoveAll||this._handleUpdated(e)},removed:e=>{this.isRemoveAll||this._handleRemoved(e)},getDetectedList:e=>{this.isRemoveAll||this._handleDetectedGadgets(e.v)},hub_online:e=>{this.isRemoveAll||this._handleHubOnline(e.v)},hub_offline:e=>{this.isRemoveAll||this._handleHubOffline(e.v)},refresh:e=>{this.isRemoveAll||this._handleDataRefresh()},reopenStream:e=>{this._handleReopenStream(e.v)}},()=>{})}},computed:{isEmptyUrl(){return this._.isEmpty(this.mapUrl)}},created(){this.$emit("select-button"),oe.$on("zoomIn",()=>{this.map.zoomIn(7)}),oe.$on("zoomOut",()=>{this.map.zoomOut(6)}),oe.$on("filter",()=>{this.choiceFilter()}),oe.$on("removeItem",()=>{this.removeItems()}),window.addEventListener("beforeunload",()=>{this.services.unsubscribe()}),this.isConnected&&this._subscribe()},mounted(){this.initloadMap()},watch:{isConnected:function(){this.toast=this.sweetbox.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1e4}),this.toast.fire({type:"success",title:"Server connected"}),this.isConnected?this._subscribe():(this.toast=this.sweetbox.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1e4}),this.toast.fire({type:"error",title:"Server disconnected"}))}},mixins:[L]},x=H,R=(i("54d9"),i("2877")),W=Object(R["a"])(x,d,c,!1,null,null,null),U=W.exports,F=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"topContainer"}},[i("div",{attrs:{id:"leftContainer"}},[i("div",{attrs:{id:"zoom"}},[i("div",{staticClass:"clickbtn",attrs:{title:"Zoom In"}},[i("img",{attrs:{id:"clickbtnPlus",src:"static/location/imgs/icon-plus.svg"},on:{click:e.zoomIn}})]),i("div",{staticClass:"clickbtn",attrs:{title:"Zoom Out"}},[i("img",{attrs:{id:"clickbtnMinus",src:"static/location/imgs/icon-minus.svg"},on:{click:e.zoomOut}})])]),e.isShowingByStage(1)?i("div",{staticClass:"clickbtn",attrs:{id:"filter",title:"Filter Beacons"}},[i("img",{attrs:{id:"clickbtnFilter",src:"static/location/imgs/icon-filter.svg"},on:{click:e.filter}})]):e._e(),e.isShowingByStage(0)?i("div",{attrs:{id:"top-remove"}},[i("div",{staticClass:"clickbtn3",attrs:{id:"removebtn",title:"Remove All"},on:{click:e.remove}})]):e._e()]),e.isShowingByStage(0)?i("div",{attrs:{id:"rightContainer"}},[i("div",{attrs:{id:"upload"}},[i("button",{attrs:{id:"clickbtn"},on:{click:function(t){return e.$refs.file.click()}}},[e._m(0)]),i("input",{ref:"file",attrs:{type:"file",id:"file",accept:"image/jpeg, image/png, image/gif"},on:{change:e.onFileChange}})])]):e._e()])},P=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"clickbtn4",attrs:{id:"btntitle",title:"Upload Map File"}},[e._v("Upload "),i("i",{staticClass:"fa fa-upload"})])}],K={name:"Top",props:{info:{type:Object,default:{}},isConnected:{type:Boolean,required:!0}},methods:{zoomIn(){oe.$emit("zoomIn")},zoomOut(){oe.$emit("zoomOut")},onFileChange(e){this.file=e.target.files[0],this.submitFile()},getMapFile(e){this.services.getMapFile},remove(){oe.$emit("removeItem")},submitFile(){this.services.postMapFile(this.file,e=>{window.location.reload()},e=>{console.warn("File upload failed")})},handleFileUpload(){this.file=this.$refs.file.files[0]},filter(){oe.$emit("filter")},isShowingByStage(e){return this.info.stage<=e}},computed:{isEmptyUrl(){return!this.url}},created(){this.getMapFile()}},V=K,z=(i("dee7"),Object(R["a"])(V,F,P,!1,null,null,null)),q=z.exports,Y={components:{Map:U,Top:q},data(){return{isLoaded:!1,isWebsocketConnected:!1,info:{},isConnected:!1,checkInterval:null}},methods:{handleMapLoad(e){this.isLoaded=e},websocketConnect(){let e=window.location.hostname;window.CONSTANTS.IS_DEV&&(e="192.168.0.15"),this.services.websocketConnect(e,5555,()=>{this.isWebsocketConnected=!0,console.log("Connect"),this.isConnected=!0,this.stopInterval()},()=>{console.log("Disconnect"),this.isConnected=!1,this.startInterval()},()=>{console.log("Error")})},startInterval(){this.checkInterval||(this.checkInterval=setInterval(()=>{this.websocketConnect()},1e4))},stopInterval(){this.checkInterval&&clearInterval(this.checkInterval),this.checkInterval=null}},created(){this.services.getInfo(e=>{this._.isObject(e)&&(this.info=e,this.websocketConnect(),this.startInterval())})}},j=Y,Z=(i("034f"),Object(R["a"])(j,a,n,!1,null,null,null)),Q=Z.exports,J=i("415c"),X=i.n(J),ee=(i("5453"),i("2f62"));i("3e8f");o["a"].use(ee["a"]);var te=new ee["a"].Store({state:{hubs:{},gadgets:{},detectedgadgets:{},ipcams:{},hubListDetectOneGadget:{},gadgetListDetectedByOneHub:{}},getters:{getHubs:e=>{return _.values(e.hubs)},getHub:e=>t=>{return _.isEmpty(e.hubs[t])?{}:e.hubs[t]},getdetectedGadgetList:e=>{return e.detectedgadgets},getDetectedGadget:e=>t=>{if(!_.isEmpty(e.detectedgadgets[t]))return e.detectedgadgets[t];console.warn(`Theres no detected gadget data in gadget id ${t}`)},getGadget:e=>t=>{if(!_.isEmpty(e.gadgets[t]))return e.gadgets[t];console.warn(`Theres no gadget data in gadget id ${t}`)},getdetectedGadgetName:e=>t=>{return e.detectedgadgets[t]?e.detectedgadgets[t].name:{}},getIpCams:e=>{return _.values(e.ipcams)},getIpCam:e=>t=>{if(e.ipcams[t])return e.ipcams[t];console.warn(`Theres no ipcam data in ipcam id ${t}`)},getHubListDetectOneGadget:e=>t=>{return e.hubListDetectOneGadget[t]?e.hubListDetectOneGadget[t]:{}},getGadgetListDetectedByOneHub:e=>t=>{return e.gadgetListDetectedByOneHub[t]?e.gadgetListDetectedByOneHub[t]:{}}},mutations:{addHub(e,t){e.hubs[t.id]||(e.hubs[t.id]=t)},addGadgets(e,t){_.forEach(t,t=>{!_.isString(t.custom)&&t.custom||(t.custom={}),e.gadgets[t.id]=t})},addGadget(e,t){!_.isString(t.custom)&&t.custom||(t.custom={}),e.gadgets[t.id]=t},addDetectedHubGadget(e,t){if(_.has(e.gadgets,t.gid)){let i=e.gadgets[t.gid];if(_.isEmpty(e.detectedgadgets[t.gid])&&(e.detectedgadgets[t.gid]={gid:i.id,hubIdList:[],name:i.name,custom:_.isObject(i.custom)?i.custom:{},tags:i.tags,account_id:i.account_id,_t:new Date/1e3}),_.isEmpty(e.detectedgadgets[t.gid].hubIdList.find(e=>e===t.hid))&&e.detectedgadgets[t.gid].hubIdList.push(t.hid),_.has(e.hubListDetectOneGadget,t.gid)||(e.hubListDetectOneGadget[t.gid]={}),_.has(e.hubListDetectOneGadget[t.gid],t.hid)){let i=e.hubListDetectOneGadget[t.gid][t.hid];if(t._t>i._t){let s=_.sortBy(e.hubListDetectOneGadget[t.gid],["_t"]),o=-1;s=_.reverse(s),s=_.values(s),o=_.findIndex(s,e=>{return e.hid===t.hid}),(o<2||Math.abs(i.dist-t.dist)>window.CONSTANTS.BEACON_DISTANCE_OFFSET)&&(e.hubListDetectOneGadget[t.gid][t.hid]=t)}}else e.hubListDetectOneGadget[t.gid][t.hid]=t;_.has(e.gadgetListDetectedByOneHub,t.hid)||(e.gadgetListDetectedByOneHub[t.hid]={}),_.has(e.gadgetListDetectedByOneHub[t.hid],t.gid)?t._t>e.gadgetListDetectedByOneHub[t.hid][t.gid]._t&&(e.gadgetListDetectedByOneHub[t.hid][t.gid]=t):e.gadgetListDetectedByOneHub[t.hid][t.gid]=t}},updateHubData(e,t){e.hubs[t.id]&&(e.hubs[t.id]=t)},updateGadgetMoiData(e,t){e.detectedgadgets[t.id]&&(e.detectedgadgets[t.id].custom.is_visible_moi=t.isVisible,e.gadgets[t.id].custom.is_visible_moi=t.isVisible)},updateGadgetData(e,t){e.gadgets[t.id]&&_.extend(e.gadgets[t.id],t),e.detectedgadgets[t.id]&&_.extend(e.detectedgadgets[t.id],t)},removeGadgetLocation(e,t){e.detectedgadgets[t]&&e.gadgets[t]&&(e.detectedgadgets[t].custom.map_location={},e.gadgets[t].custom.map_location={})},addGadgetLocation(e,t){let i=e.gadgets[t.gid],s=e.detectedgadgets[t.gid];i&&s&&(i.custom.map_location=_.pick(t,["x","y"]),s.custom.map_location=_.pick(t,["x","y"]))},removeGadget(e,t){delete e.gadgets[t],delete e.hubListDetectOneGadget[t],_.forEach(e.gadgetListDetectedByOneHub,(e,i)=>{_.forEach(e,(i,s)=>{s===t&&delete e[s]})})},removeDetectedGadgetWithHub(e,t){delete e.gadgetListDetectedByOneHub[t.hid][t.gid],delete e.hubListDetectOneGadget[t.gid][t.hid],e.detectedgadgets[t.gid]&&(e.detectedgadgets[t.gid].hubIdList=_.without(e.detectedgadgets[t.gid].hubIdList,t.hid))},removeHub(e,t){e.hubs[t]={},o["a"].delete(e.hubs,t)},removeIpcam(e,t){e.ipcams[t]={},o["a"].delete(e.ipcams,t)},addIpcams(e,t){_.forEach(t,t=>{e.ipcams[t.id]=t})},addIpcam(e,t){e.ipcams[t.id]=t},updateIpcamData(e,t){e.ipcams[t.id]&&(e.ipcams[t.id]=t)}}}),ie=i("3d20"),se=i.n(ie);i("1aa9");i.d(t,"EventBus",function(){return oe}),o["a"].prototype.$http=m.a,o["a"].prototype.services=s,o["a"].prototype.sweetbox=se.a,o["a"].config.productionTip=!1;const oe=new o["a"]({});o["a"].use(X.a),new o["a"]({store:te,render:e=>e(Q)}).$mount("#locationTracking")},"64a9":function(e,t,i){},b347:function(e,t,i){},dee7:function(e,t,i){"use strict";var s=i("1d68"),o=i.n(s);o.a}});
//# sourceMappingURL=app.a042f524.js.map